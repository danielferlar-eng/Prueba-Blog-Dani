<!doctype html>


const newComment = { id: Date.now(), name, text, date: (new Date()).toLocaleString('es-ES') };
const current = loadComments();
current[article.id] = current[article.id] || [];
current[article.id].push(newComment);
saveComments(current);


// actualiza UI: añade el comentario y limpia campos
const list = document.getElementById(`comments-list-${article.id}`);
list.append(renderComment(article.id, newComment));
nameInput.value = '';
textarea.value = '';


// actualizar contador
const counter = list.parentElement.parentElement.querySelector('.comments-count');
if(counter) counter.textContent = `Comentarios (${current[article.id].length})`;
});


formWrap.append(formTitle, nameInput, textarea, btn, note);


commentsSection.append(headerComments, listWrap, formWrap);


// Montaje
card.append(header);
if(imgEl) card.append(imgEl);
card.append(body, commentsSection);


container.append(card);
});
}


function renderComment(articleId, comment){
const c = el('div',{class:'comment', id:`comment-${comment.id}`});
const meta = el('div',{class:'meta'});
const left = el('div');
left.append(el('div',{class:'name', text:comment.name}), el('div',{class:'date', text:comment.date}));
const right = el('div');
const delBtn = el('button',{class:'trash-btn','aria-label':'Eliminar comentario', title:'Eliminar comentario'});
delBtn.append(svgIconTrash());
delBtn.addEventListener('click', () => {
if(!confirm('¿Seguro que quieres eliminar este comentario?')) return;
const store = loadComments();
store[articleId] = (store[articleId] || []).filter(x => x.id !== comment.id);
saveComments(store);
// eliminar nodo
const node = document.getElementById(`comment-${comment.id}`);
if(node) node.remove();
// actualizar contador
const counter = document.getElementById(`comments-list-${articleId}`).parentElement.parentElement.querySelector('.comments-count');
if(counter) counter.textContent = `Comentarios (${(store[articleId] || []).length})`;
});
right.append(delBtn);
meta.append(left,right);


const text = el('div',{class:'text', text:comment.text});
c.append(meta, text);
return c;
}


function svgIconMessage(){
return el('span',{html:`<svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 15a2 2 0 0 1-2 2H8l-5 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="#7c3aed" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>`});
}
function svgIconSend(){
return el('span',{html:`<svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 2L11 13" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>`});
}
function svgIconTrash(){
return el('span',{html:`<svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18" stroke="#ec4899" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 6v12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6" stroke="#ec4899" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M10 11v6" stroke="#ec4899" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 11v6" stroke="#ec4899" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2" stroke="#ec4899" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>`});
}


// pequeña función para escapar < y & para evitar inyección si alguien mete HTML
function escapeHtml(str){ return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>'); }


// Inicializa
document.addEventListener('DOMContentLoaded', () => renderArticles());
</script>
</body>
</html>
